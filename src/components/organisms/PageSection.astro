---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

export interface Props {
  title?: string;
  subtitle?: string;
  image?: ImageMetadata | string;
  imageAlt?: string;
  imagePosition?: 'left' | 'right' | 'top' | 'bottom' | 'background';
  contentWidth?: 'narrow' | 'wide' | 'full';
  padding?: 'sm' | 'md' | 'lg' | 'xl';
  backgroundColor?: string;
  textColor?: string;
  class?: string;
}

const {
  title,
  subtitle,
  image,
  imageAlt = '',
  imagePosition = 'right',
  contentWidth = 'wide',
  padding = 'lg',
  backgroundColor = 'bg-white',
  textColor = 'text-neutral-900',
  class: className = ''
} = Astro.props;

const paddingClasses = {
  sm: 'py-8 md:py-12',
  md: 'py-12 md:py-16',
  lg: 'py-16 md:py-24',
  xl: 'py-24 md:py-32'
};

const contentWidthClasses = {
  narrow: 'max-w-3xl',
  wide: 'max-w-6xl',
  full: 'max-w-full'
};

const gridClasses = {
  left: 'md:grid-cols-2 md:gap-12',
  right: 'md:grid-cols-2 md:gap-12',
  top: 'grid-cols-1',
  bottom: 'grid-cols-1',
  background: 'grid-cols-1'
};

const imageOrderClass = imagePosition === 'left' ? 'md:order-first' : '';
const contentOrderClass = imagePosition === 'left' ? 'md:order-last' : '';
---

<section
  class={`relative w-full ${backgroundColor} ${paddingClasses[padding]} ${className}`}
>
  {
    /* Background Image Mode */
    imagePosition === 'background' && image && (
      <div class="absolute inset-0 z-0">
        {typeof image === 'string' ? (
          <img
            src={image}
            alt={imageAlt}
            class="w-full h-full object-cover opacity-10"
          />
        ) : (
          <Image
            src={image}
            alt={imageAlt}
            class="w-full h-full object-cover opacity-10"
            widths={[640, 1024, 1280, 1920]}
            sizes="100vw"
          />
        )}
      </div>
    )
  }

  <div
    class={`relative z-10 container mx-auto px-6 ${contentWidthClasses[contentWidth]}`}
  >
    <div class={`grid ${gridClasses[imagePosition]} gap-8 items-center`}>
      {/* Content Section */}
      <div class={`space-y-6 ${textColor} ${contentOrderClass}`}>
        {
          title && (
            <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold">{title}</h2>
          )
        }
        {
          subtitle && (
            <p class="text-lg md:text-xl text-neutral-600">{subtitle}</p>
          )
        }

        <div class="prose prose-lg max-w-none">
          <slot />
        </div>

        <!-- Actions Slot -->
        <div class="pt-4">
          <slot name="actions" />
        </div>
      </div>

      {/* Image Section (for left/right/top/bottom positions) */}
      {
        image && imagePosition !== 'background' && (
          <div class={imageOrderClass}>
            {typeof image === 'string' ? (
              <img
                src={image}
                alt={imageAlt}
                class="w-full h-auto rounded-lg shadow-lg"
              />
            ) : (
              <Image
                src={image}
                alt={imageAlt}
                class="w-full h-auto rounded-lg shadow-lg"
                widths={[400, 600, 800, 1200]}
                sizes="(max-width: 768px) 100vw, 50vw"
              />
            )}
          </div>
        )
      }
    </div>
  </div>
</section>
