---
import { Image } from 'astro:assets';
import { getEntry } from 'astro:content';
import Link from '@components/atoms/Link.astro';
import SocialLinks from '@components/molecules/SocialLinks.astro';
import { renderMarkdown } from '@utils/renderMarkdown';

// Fetch all data internally - no props needed except className
export interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;

// Fetch site config
const siteConfigEntry = await getEntry('site', 'config');
if (!siteConfigEntry) {
  throw new Error('Site configuration not found');
}
const siteConfig = siteConfigEntry.data;

// Fetch footer navigation menus
const footerNav1 = await getEntry('navigation', 'footer-1');
const footerNav2 = await getEntry('navigation', 'footer-2');

// Prepare description with fallback logic
const description = siteConfig.footer?.description || siteConfig.description;

// Prepare copyright
const currentYear = new Date().getFullYear();
const copyrightText = `Â© ${currentYear} ${siteConfig.title}.`;
---

<footer class={`bg-neutral-900 text-white ${className}`}>
	<div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
		<!-- Main footer content: 3 columns on desktop, stack on mobile -->
		<div class="mb-8 grid grid-cols-1 gap-8 lg:grid-cols-2">
			<!-- Left side: Content Section (50% on desktop) -->
			<div class="space-y-6">
				<!-- Logo -->
				<div>
					<Link href="/" variant="unstyled" class="block">
						<img
							src="/logo-extended-white.svg"
							alt={siteConfig.title}
							class="h-12 w-auto"
						/>
					</Link>
				</div>

				<!-- Description -->
				<p class="max-w-md text-neutral-300">
					{description}
				</p>

				<!-- Social Links -->
				<SocialLinks class="justify-start" iconClass="w-5 h-5" />
			</div>

			<!-- Right side: Two menu sections (25% each on desktop) -->
			<div class="grid grid-cols-1 gap-8 sm:grid-cols-2">
				<!-- Menu Section 1 -->
				{
					footerNav1 && (
						<ul class="space-y-3">
							{footerNav1.data.items.map((item) => (
								<li>
									<Link href={item.href} variant="footer">
										{item.label}
									</Link>
								</li>
							))}
						</ul>
					)
				}

				<!-- Menu Section 2 -->
				{
					footerNav2 && (
						<ul class="space-y-3">
							{footerNav2.data.items.map((item) => (
								<li>
									<Link href={item.href} variant="footer">
										{item.label}
									</Link>
								</li>
							))}
						</ul>
					)
				}
			</div>
		</div>

		<!-- Bottom Section: Copyright and footer content -->
		<div class="border-t border-white/10 pt-8">
			<div class="space-y-2 text-center *:text-sm">
				<p class="">{copyrightText}</p>
				<div
					class="*:text-sm"
					set:html={await renderMarkdown(siteConfig.footer.bottom)}
				/>
			</div>
		</div>
	</div>
</footer>
